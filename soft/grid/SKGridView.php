<?phpnamespace soft\grid;use soft\data\SPagination;use soft\web\SView;use soft\widget\MultiLinkPager;use Yii;use soft\helpers\SArray;use kartik\grid\GridView;use yii\helpers\ArrayHelper;use soft\helpers\SUrl;use soft\service\Attribute;use soft\widget\SButton;use soft\widget\SBulkButtons;use soft\extra\STemplate;/** * @author Shukurullo Odilov * @property-read mixed $modelClass * @property SView $view */class SKGridView extends GridView{    use SKGridViewTrait;    public $pjax = false;    public $striped = true;    public $condensed = true;    public $responsive = true;    public $panel = [];    public $cols = [];    public $config = [];    public $_config = [];    public $columns = [];    public $columnVars = [];    public $serialColumn = true;    public $toolbarTemplate = -1;    public $toolbarButtons = [];    public $bulkButtons = [];    public $bulkButtonsTemplate = -1;    /**     * @var bool Whether register break-words css styles     * @see registerBreakWordsStyles()     */    public $breakWords = false;    public function defaultValues()    {        return [            'panel' => [                'type' => 'primary',                'after' => "{bulk-buttons}",            ],            'toolbarButtons' => [                'create' => [                    'modal' => false,                    'pjax' => false,                    'url' => SUrl::to(['create']),                    'style' => SButton::STYLE['default'],                    'icon' => 'plus',                    'title' => Yii::t('app', 'Create new'),                ],                'refresh' => [                    'url' => SUrl::current(),                    'style' => SButton::STYLE['default'],                    'icon' => 'refresh',                    'title' => Yii::t('app', 'Refresh'),                ],            ],            'bulkButtons' => [                'delete' => [                    "confirmMessage" => Yii::t('app', 'Are you sure to delete all selected items?'),                    'label' => Yii::t('app', "Delete"),                    'url' => SUrl::to(['/general/bulk-delete-models', 'modelClass' => $this->getModelClass()]),                    'icon' => 'trash',                    'style' => 'btn-danger',                    'title' => Yii::t('app', 'Delete selected items'),                ],            ],        ];    }    public function run()    {        $defaultColumns = $this->defaultColumns();        // COLUMNS        $model = new $this->dataProvider->query->modelClass;        // Add serial Column if no exist        if ($this->serialColumn && !in_array("serialColumn", $this->cols)) {            array_unshift($this->cols, $defaultColumns['serialColumn']);        }        // Init columns        $this->columns = Attribute::selectColumns($model, $this->cols, $this->columnVars, $defaultColumns);        parent::init();        // Defaults        $default = $this->defaultValues();        $this->panel = ArrayHelper::merge($default['panel'], $this->panel);        $this->toolbarButtons = ArrayHelper::merge($default['toolbarButtons'], $this->toolbarButtons);        if ($this->bulkButtons !== false) {            $this->bulkButtons = ArrayHelper::merge($default['bulkButtons'], $this->bulkButtons);        }        $this->_config = ArrayHelper::merge($this->_config, $this->config);        //Toolbar  Buttons        $this->toolbar = [            [                'content' => $this->renderToolbarContent().$this->renderPagerDropdown(),            ]        ];        if ($this->hasBulkButtons()) {            $this->panel['after'] = $this->renderBulkButtons();            $this->view->registerAjaxCrudAssets();        }        $heading = SArray::getValue($this->panel, 'heading');        if ($heading != false){            SArray::setValueIfNoValid($this->panel, 'heading', $this->view->title);        }        $this->registerBreakWordsStyles();        $this->pager = array_merge([            'class' => MultiLinkPager::class,            'maxButtonCount' => 10,            'prevPageCssClass' => 'prev hidden-xs',            'nextPageCssClass' => 'next hidden-xs',            'activePageAsLink' => false], $this->pager);        //	Run        parent::run();    }    /**     * Default columns     */    public function defaultColumns()    {        return [            'image' => [                'filter' => false,                'attribute' => 'image',                'format' => ['image', ['height' => '100px']],            ],            'status' => [                'attribute' => 'status',                'format' => 'status',                'vAlign' => 'middle',                'filter' => [0 => Yii::t('app', 'Inactive'), 1 => Yii::t('app', 'Active')],            ],            'updated_at' => [                'attribute' => 'updated_at',                'format' => 'dateTimeUz',                'filter' => false,            ],            'created_at' => [                'attribute' => 'created_at',                'format' => 'dateTimeUz',                'filter' => false,            ],            'serialColumn' => [                'class' => 'kartik\grid\SerialColumn',                'width' => '50px',            ],            'checkboxColumn' => [                'class' => 'kartik\grid\CheckboxColumn',                'width' => '20px',            ],            'radioColumn' => [                'class' => 'kartik\grid\RadioColumn',                'width' => '20px',            ],            'actionColumn' => [                'class' => 'soft\grid\SActionColumn',                'width' => '100px',            ],        ];    }    public function renderToolbarContent()    {        $toolbarButtons = $this->renderToolbarButtons();        return $toolbarButtons;    }    public function renderToolbarButtons()    {        if ($this->toolbarButtons == false || $this->toolbarButtons == '') {            return "";        }        if (!is_array($this->toolbarButtons)) {            return $this->toolbarButtons;        }        $buttons = [];        foreach ($this->toolbarButtons as $buttonName => $buttonConfig) {            $buttons[$buttonName] = SButton::widget([                'config' => $buttonConfig            ]);        }        return STemplate::widget([            'template' => $this->toolbarTemplate,            'items' => $buttons,        ]);    }    public function renderBulkButtons()    {        if ($this->bulkButtonsTemplate === false) {            return "";        }        if (!is_array($this->bulkButtons)) {            return $this->bulkButtons;        }        return SBulkButtons::widget([            'template' => $this->bulkButtonsTemplate,            'buttons' => $this->bulkButtons,        ]);    }    public function getModelClass()    {        return $this->dataProvider->query->modelClass;    }    private function hasBulkButtons()    {        if ($this->bulkButtons === false) {            if ($this->panel['after'] == "{bulk-buttons}") {                $this->panel['after'] = false;            }            return false;        }        if ($this->panel['after'] != "{bulk-buttons}") {            return false;        }        return true;    }    public function registerBreakWordsStyles()    {        if ($this->breakWords){            $css = "            #{$this->getId()} table td {                word-break: break-word;                white-space: normal;                }            ";            $this->view->registerCss($css);        }    }}?>